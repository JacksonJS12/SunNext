@model SunNext.Web.ViewModels.SolarAssets.SolarAssetViewModel

@{
    ViewData["Title"] = "Asset Details";
}
<style>
    .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }

    .metric-card {
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(51, 65, 85, 0.6);
        border-radius: 12px;
        padding: 24px;
        text-align: center;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #3b82f6, #06b6d4, #10b981);
        border-radius: 12px 12px 0 0;
    }

    .metric-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        border-color: rgba(59, 130, 246, 0.5);
    }

    .metric-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #ffffff;
        margin-bottom: 8px;
        background: linear-gradient(135deg, #3b82f6, #06b6d4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .metric-label {
        font-size: 0.95rem;
        color: #cbd5e1;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
    }

</style>
<div class="container py-4">
    <div class="page-header">
        <h1 class="asset-title">☀️ @Model.Name</h1>
        <div class="status-indicator">
            <div class="status-dot @(Model.IsOnline ? "bg-success" : "bg-secondary")"></div>
            <span class=" @(Model.IsOnline ? "text-success" : "text-secondary")">@(Model.IsOnline ? "Active & Generating" : "Offline")</span>
        </div>
    </div>
    <div class="d-flex justify-content-end mb-4 fade-in">
        <div class="btn-group" role="group">
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-warning me-2">
                <i class="bi bi-pencil-square"></i> Edit
            </a>
            <a asp-action="Delete" asp-route-id="@Model.Id" class="btn btn-outline-danger"
               onclick="return confirm('Are you sure you want to delete this solar asset?')">
                <i class="bi bi-trash"></i> Delete
            </a>
        </div>
    </div>
    <div class="metric-grid fade-in">
        <div class="metric-card">
            <div class="metric-value">@Model.PowerKw</div>
            <div class="metric-label">
                kW Power
                <i class="bi bi-info-circle ms-1 tooltip-icon" data-bs-toggle="tooltip" title="Maximum instantaneous output of the solar asset in kilowatts (kW)."></i>
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-value">@Model.EfficiencyPercent%</div>
            <div class="metric-label">
                % Efficiency
                <i class="bi bi-info-circle ms-1 tooltip-icon" data-bs-toggle="tooltip" title="Efficiency represents how much of the sunlight is converted into usable energy."></i>
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-value">@Model.CapacityKw</div>
            <div class="metric-label">
                kWp Capacity
                <i class="bi bi-info-circle ms-1 tooltip-icon" data-bs-toggle="tooltip" title="Total installed peak capacity measured under standard conditions."></i>
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-value">@Model.EnergyTodayKWh</div>
            <div class="metric-label">
                kWh Today
                <i class="bi bi-info-circle ms-1 tooltip-icon" data-bs-toggle="tooltip" title="Total energy produced by the system today in kilowatt-hours."></i>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            

            <div class="dark-card p-4 mb-4 fade-in">
                <h5 class="section-title">Energy Production</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">Today</span>
                            <span class="info-value">@Model.EnergyTodayKWh kWh <i class="bi bi-info-circle tooltip-icon" title="Energy generated today" data-bs-toggle="tooltip"></i></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">This Month</span>
                            <span class="info-value">@Model.EnergyMonthKWh kWh <i class="bi bi-info-circle tooltip-icon" title="Energy generated this month" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">This Year</span>
                            <span class="info-value">@Model.EnergyYearKWh kWh <i class="bi bi-info-circle tooltip-icon" title="Energy generated this year" data-bs-toggle="tooltip"></i></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Total Lifetime</span>
                            <span class="info-value">@Model.EnergyTotalKWh kWh <i class="bi bi-info-circle tooltip-icon" title="Total energy produced" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dark-card p-4 mb-4 fade-in">
                <h5 class="section-title">Technical Specifications</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">Max Power</span>
                            <span class="info-value">@Model.PowerKw kW <i class="bi bi-info-circle tooltip-icon" title="Maximum power output" data-bs-toggle="tooltip"></i></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Efficiency</span>
                            <span class="info-value">@Model.EfficiencyPercent% <i class="bi bi-info-circle tooltip-icon" title="System efficiency" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">Capacity</span>
                            <span class="info-value">@Model.CapacityKw kWp <i class="bi bi-info-circle tooltip-icon" title="Installed capacity" data-bs-toggle="tooltip"></i></span>
                        </div>

                        <div class="info-row">
                            <span class="info-label">Panel Type</span>
                            <span class="info-value">@Model.Type <i class="bi bi-info-circle tooltip-icon" title="Solar panel type" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dark-card p-4 mb-4 fade-in">
                <h5 class="section-title">Installation Details</h5>
                <div class="row">
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">Installer</span>
                            <span class="info-value">@Model.InstallerName <i class="bi bi-info-circle tooltip-icon" title="Installation company" data-bs-toggle="tooltip"></i></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email</span>
                            <span class="info-value">@Model.InstallerEmail <i class="bi bi-info-circle tooltip-icon" title="Contact email" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="info-row">
                            <span class="info-label">Phone</span>
                            <span class="info-value">@Model.InstallerPhone <i class="bi bi-info-circle tooltip-icon" title="Contact phone" data-bs-toggle="tooltip"></i></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Commissioned</span>
                            <span class="info-value">@Model.CommissioningDate.ToString("dd MMM yyyy") <i class="bi bi-info-circle tooltip-icon" title="Commissioning date" data-bs-toggle="tooltip"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dark-card p-4 fade-in">
                <h5 class="section-title">Location Details</h5>
                <div class="info-row">
                    <span class="info-label">Address</span>
                    <span class="info-value">@Model.Address <i class="bi bi-info-circle tooltip-icon" title="Installation address" data-bs-toggle="tooltip"></i></span>
                </div>
                <div class="info-row">
                    <span class="info-label">Time Zone</span>
                    <span class="info-value">@Model.TimeZone <i class="bi bi-info-circle tooltip-icon" title="Local time zone" data-bs-toggle="tooltip"></i></span>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="dark-card p-4 mb-4 fade-in">
                <div class="asset-image">
                    <img src="@Model.ImageUrl" class="img-fluid" alt="@Model.Name" />
                </div>
                <p class="text-center text-muted mb-0">Virtual Power Station</p>
            </div>

            <div class="dark-card p-4 fade-in">
                <h5 class="section-title">Installation Map</h5>
                <div class="map-container">
                    <div id="map"></div>
                </div>
            </div>
            
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        initTooltips();

        const address = "@Model.Address";
        const encodedAddress = encodeURIComponent(address);
        const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodedAddress}`;

        fetch(url, {
            headers: {
                'Accept': 'application/json',
                'User-Agent': 'SunNextPlatform/1.0'
            }
        })
            .then(res => res.json())
            .then(data => {
                if (data.length > 0) {
                    const lat = data[0].lat;
                    const lon = data[0].lon;
                    const map = L.map('map').setView([lat, lon], 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; OpenStreetMap contributors'
                    }).addTo(map);

                    L.marker([lat, lon]).addTo(map)
                        .bindPopup('<strong>@Model.Name</strong><br>' + address)
                        .openPopup();

                    setTimeout(initTooltips, 300);
                } else {
                    document.getElementById('map').innerHTML = '<div class="text-center text-danger p-4">Could not find location</div>';
                }
            })
            .catch(() => {
                document.getElementById('map').innerHTML = '<div class="text-center text-danger p-4">Failed to load map</div>';
            });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
    });

    function initTooltips() {
        document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => {
            if (bootstrap.Tooltip.getInstance(el)) {
                bootstrap.Tooltip.getInstance(el).dispose();
            }
            new bootstrap.Tooltip(el, {
                container: 'body',
                placement: 'top',
                boundary: 'viewport'
            });
        });
    }
</script>
